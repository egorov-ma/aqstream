# Notification Service

Notification Service –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ Telegram.

## –û–±–∑–æ—Ä

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ü–æ—Ä—Ç | 8084 |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | postgres-shared |
| –°—Ö–µ–º–∞ | notification_service |

## –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

- Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Bot API) ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª
- –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π (Mustache + Markdown)
- –û—á–µ—Ä–µ–¥—å –æ—Ç–ø—Ä–∞–≤–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–æ–∫

## –ö–∞–Ω–∞–ª—ã

| –ö–∞–Ω–∞–ª | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-------|-----------|
| Telegram | Telegram Bot API |

**–í–∞–∂–Ω–æ:** Telegram ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
Email –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –Ω–æ –Ω–µ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/v1/notifications/send` | –û—Ç–ø—Ä–∞–≤–∫–∞ (internal) |
| GET | `/api/v1/notifications/templates` | –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤ |
| GET | `/api/v1/notifications/preferences` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| PUT | `/api/v1/notifications/preferences` | –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

## –®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

| –®–∞–±–ª–æ–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `user.welcome` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| `registration.confirmed` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –±–∏–ª–µ—Ç–æ–º |
| `registration.cancelled` | –û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| `reservation.expired` | –ò—Å—Ç–µ—á–µ–Ω–∏–µ –±—Ä–æ–Ω–∏ |
| `event.reminder` | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Å–æ–±—ã—Ç–∏–∏ (–∑–∞ 24—á) |
| `event.changed` | –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ–±—ã—Ç–∏–∏ |
| `event.cancelled` | –û—Ç–º–µ–Ω–∞ —Å–æ–±—ã—Ç–∏—è |
| `waitlist.available` | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –∏–∑ –ª–∏—Å—Ç–∞ –æ–∂–∏–¥–∞–Ω–∏—è |
| `payment.receipt` | –ß–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ |

### –§–æ—Ä–º–∞—Ç —à–∞–±–ª–æ–Ω–∞ (Mustache + Markdown)

```markdown
<!-- templates/telegram/registration.confirmed.md -->
üé´ *–ë–∏–ª–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏–µ*

–ü—Ä–∏–≤–µ—Ç, {{firstName}}!

–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞ *{{eventTitle}}*.

üìã *–î–µ—Ç–∞–ª–∏:*
‚Ä¢ –ö–æ–¥ –±–∏–ª–µ—Ç–∞: `{{confirmationCode}}`
‚Ä¢ –î–∞—Ç–∞: {{eventDate}}
‚Ä¢ –ú–µ—Å—Ç–æ: {{eventLocation}}

[–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–æ–±—ã—Ç–∏–∏]({{eventUrl}})
```

## –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ RabbitMQ
2. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —à–∞–±–ª–æ–Ω–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Bot API
4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (success/failure)

**Fallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ Telegram:**
- –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω Telegram ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- –í –ª–æ–≥–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è warning

## –°–æ–±—ã—Ç–∏—è (RabbitMQ)

### –ü–æ—Ç—Ä–µ–±–ª—è–µ–º—ã–µ

| Event | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ |
|-------|-------------|
| `user.registered` | Welcome —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram |
| `registration.created` | –ë–∏–ª–µ—Ç —Å QR-–∫–æ–¥–æ–º –≤ Telegram |
| `registration.cancelled` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ |
| `reservation.expired` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –±—Ä–æ–Ω–∏ |
| `event.cancelled` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ —Å–æ–±—ã—Ç–∏—è –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º |
| `event.changed` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö |
| `event.reminder` | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Å–æ–±—ã—Ç–∏–∏ (–∑–∞ 24—á) |
| `payment.completed` | –ß–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ |
| `waitlist.available` | –ú–µ—Å—Ç–æ –∏–∑ –ª–∏—Å—Ç–∞ –æ–∂–∏–¥–∞–Ω–∏—è |

## Telegram Bot

**–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:**

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start {token}` | –ü—Ä–∏–≤—è–∑–∫–∞ Telegram –∫ –∞–∫–∫–∞—É–Ω—Ç—É |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ |
| `/tickets` | –ú–æ–∏ –±–∏–ª–µ—Ç—ã |

**–ü—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–æ–ª—É—á–∞–µ—Ç –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—É—é —Å—Å—ã–ª–∫—É
2. –°—Å—ã–ª–∫–∞ –≤–µ–¥—ë—Ç –∫ –±–æ—Ç—É —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
3. –ë–æ—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç `chat_id` –∫ –∞–∫–∫–∞—É–Ω—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —ç—Ç–æ—Ç —á–∞—Ç

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ |
| `TELEGRAM_BOT_USERNAME` | Username –±–æ—Ç–∞ |

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —á—Ç–µ–Ω–∏–µ

- [Service Topology](../../../architecture/service-topology.md)
